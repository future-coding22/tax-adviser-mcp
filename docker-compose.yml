version: '3.8'

services:
  tax-advisor-dev:
    # Build from the Dockerfile in the current directory
    build:
      context: .
      dockerfile: Dockerfile
    
    container_name: tax-advisor-mcp-dev
    
    # Map the host port 3000 to the container port 3000
    # The MCP server runs on port 3000 by default
    ports:
      - "3000:3000"
      
    # Volumes for development to enable live-reloading and data persistence
    volumes:
      # Mount the entire project directory to the container
      - .:/app
      # Use an anonymous volume to prevent host node_modules from overwriting container's
      - /app/node_modules
      # Use named volumes for data that should persist across container restarts
      - knowledge:/app/knowledge
      - logs:/app/logs
      
    # Load environment variables from a .env file in the project root
    env_file:
      - .env
      
    # Override the Dockerfile's CMD to run in development mode with hot-reloading
    command: npm -v
    
    # Keep the container running and allow attaching an interactive shell
    tty: true
    stdin_open: true

# Named volumes for persistent data
volumes:
  knowledge:
  logs:
